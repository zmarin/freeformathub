---
import type { Tool } from '../../types';
import BaseLayout from '../../layouts/BaseLayout.astro';
import AdPlacement from '../ads/AdPlacement.astro';

export interface Props {
  tool: Tool;
  children?: any;
}

const { tool } = Astro.props;

// Generate structured data for the tool
const jsonLd = {
  "@context": "https://schema.org",
  "@type": "SoftwareApplication",
  "name": tool.name,
  "description": tool.description,
  "applicationCategory": "BusinessApplication",
  "operatingSystem": "Any",
  "permissions": "no-storage",
  "isAccessibleForFree": true,
  "creator": {
    "@type": "Organization",
    "name": "FreeFormatHub"
  }
};

const containerWidth = tool.layoutOptions?.containerWidth || 'narrow';
const maxWidthClass = {
  narrow: 'max-w-2xl',
  wide: 'max-w-4xl',
  full: 'max-w-full'
}[containerWidth];
---

<BaseLayout
  title={tool.seoTitle}
  description={tool.seoDescription}
  keywords={tool.keywords}
  jsonLd={jsonLd}
>
  <!-- Very minimal header -->
  <section style="background-color: var(--color-surface); border-bottom: 1px solid var(--color-border);">
    <div class={`${maxWidthClass} mx-auto px-4 py-6`}>
      <div class="text-center">
        <div class="inline-flex items-center gap-3 mb-3">
          <div style="
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, var(--color-primary), var(--color-accent));
            border-radius: var(--radius-lg);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.25rem;
            color: white;
          ">
            {tool.icon}
          </div>
          <h1 style="
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--color-text-primary);
            margin: 0;
          ">
            {tool.name}
          </h1>
        </div>

        {tool.layoutOptions?.showBreadcrumbs !== false && (
          <nav aria-label="Breadcrumb" class="text-sm">
            <a href="/" style="color: var(--color-text-secondary);" class="hover:text-blue-600">Home</a>
            <span style="color: var(--color-text-muted); margin: 0 8px;">â€¢</span>
            <a href={`/${tool.category?.id || ''}`} style="color: var(--color-text-secondary);" class="hover:text-blue-600">
              {tool.category?.name || 'Tools'}
            </a>
          </nav>
        )}
      </div>
    </div>
  </section>

  <!-- Clean, focused content area -->
  <div class={`${maxWidthClass} mx-auto px-4 py-8`}>
    <!-- Tool Interface - Clean and simple -->
    <div class="card" style="margin-bottom: var(--space-2xl); box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);">
      <slot />
    </div>

    <!-- Minimal features if enabled -->
    {tool.layoutOptions?.showFeatures !== false && (
      <div style="text-align: center; margin-bottom: var(--space-2xl);">
        <div style="display: inline-flex; align-items: center; gap: var(--space-xl); padding: var(--space-lg); background-color: var(--color-surface-secondary); border-radius: var(--radius-lg);">
          <!-- Privacy -->
          <div style="display: flex; align-items: center; gap: var(--space-sm);">
            <div style="
              width: 24px;
              height: 24px;
              background-color: var(--color-success-light);
              border-radius: 50%;
              display: flex;
              align-items: center;
              justify-content: center;
            ">
              <svg width="12" height="12" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24" style="color: var(--color-success);">
                <path stroke-linecap="round" stroke-linejoin="round" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"/>
              </svg>
            </div>
            <span style="color: var(--color-text-secondary); font-size: 0.875rem; font-weight: 500;">
              Privacy First
            </span>
          </div>

          <!-- Fast -->
          <div style="display: flex; align-items: center; gap: var(--space-sm);">
            <div style="
              width: 24px;
              height: 24px;
              background-color: var(--color-primary-light);
              border-radius: 50%;
              display: flex;
              align-items: center;
              justify-content: center;
            ">
              <svg width="12" height="12" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24" style="color: var(--color-primary);">
                <path stroke-linecap="round" stroke-linejoin="round" d="M13 10V3L4 14h7v7l9-11h-7z"/>
              </svg>
            </div>
            <span style="color: var(--color-text-secondary); font-size: 0.875rem; font-weight: 500;">
              Instant Results
            </span>
          </div>

          <!-- Free -->
          <div style="display: flex; align-items: center; gap: var(--space-sm);">
            <div style="
              width: 24px;
              height: 24px;
              background-color: var(--color-accent-light);
              border-radius: 50%;
              display: flex;
              align-items: center;
              justify-content: center;
            ">
              <svg width="12" height="12" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24" style="color: var(--color-accent);">
                <path stroke-linecap="round" stroke-linejoin="round" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1"/>
              </svg>
            </div>
            <span style="color: var(--color-text-secondary); font-size: 0.875rem; font-weight: 500;">
              100% Free
            </span>
          </div>
        </div>
      </div>
    )}

    <!-- Minimal ad placement -->
    <div style="text-align: center; margin: var(--space-2xl) 0;">
      <div style="max-width: 728px; margin: 0 auto; padding: var(--space-lg); background-color: var(--color-surface-secondary); border: 1px dashed var(--color-border); border-radius: var(--radius-lg);">
        <AdPlacement type="footer" lazy={true} />
      </div>
    </div>

    <!-- Compact FAQ if enabled -->
    {(tool.faq?.length ?? 0) > 0 && tool.layoutOptions?.showFAQ !== false && (
      <details class="group" style="margin-top: var(--space-2xl);">
        <summary style="
          display: flex;
          justify-content: center;
          align-items: center;
          gap: var(--space-sm);
          cursor: pointer;
          padding: var(--space-lg);
          background-color: var(--color-surface-secondary);
          border-radius: var(--radius-lg);
          transition: background-color var(--transition-fast);
          text-align: center;
        " class="hover:bg-gray-100 dark:hover:bg-gray-700">
          <span style="font-weight: 600; color: var(--color-text-primary);">
            Common Questions
          </span>
          <svg class="w-5 h-5 group-open:rotate-180 transition-transform" style="color: var(--color-text-secondary);" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
          </svg>
        </summary>
        <div style="padding: var(--space-xl) 0;">
          <div style="display: grid; gap: var(--space-lg); max-width: 600px; margin: 0 auto;">
            {tool.faq?.slice(0, 3).map((faqItem: any) => (
              <details class="group">
                <summary style="
                  cursor: pointer;
                  padding: var(--space-md);
                  background-color: var(--color-surface-secondary);
                  border-radius: var(--radius-md);
                  font-weight: 600;
                  color: var(--color-text-primary);
                  text-align: left;
                ">
                  {faqItem.question}
                </summary>
                <div style="padding: var(--space-md); color: var(--color-text-secondary); line-height: 1.6;">
                  {faqItem.answer}
                </div>
              </details>
            ))}
          </div>
        </div>
      </details>
    )}
  </div>
</BaseLayout>